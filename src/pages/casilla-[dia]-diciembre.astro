---
import Layout from '@/layouts/Layout.astro'
import Footer from '@/sections/Footer.astro'
import Header from '@/sections/Header.astro'
import Countdown from '@/components/Countdown.astro'
import Button from '@/components/Button.astro'
import { cells } from '@/data/days-data'
import AnagramGame from '@/components/games/AnagramGame.astro'
import TriviaGame from '@/components/games/TriviaGame.astro'
import PuzzleGame from '@/components/games/PuzzleGame.astro'
import MemoryGame from '@/components/games/MemoryGame.astro'
import RacerGame from '@/components/games/RacerGame.astro'
import CamperGame from '@/components/games/CamperGame.astro'
import SnakeGame from '@/components/games/SnakeGame.astro'
import CircusGame from '@/components/games/CircusGame.astro'
import DronGame from '@/components/games/DronGame.astro'
import HamsterGame from '@/components/games/HamsterGame.astro'
import FlightGame from '@/components/games/FlightGame.astro'
import ArkanoidGame from '@/components/games/ArkanoidGame.astro'
import SeaGame from '@/components/games/SeaGame.astro'
import NoiseGame from '@/components/games/NoiseGame.astro'
import { isAdmin } from '@/utils/admin'
import { supabaseAdmin } from '@/supabase-admin'
import SafariGame from '@/components/games/SafariGame.astro'

const {
  params: { dia: paramDay },
} = Astro

const paramDayNumber = Number(paramDay)
if (Number.isNaN(paramDayNumber)) return Astro.redirect('/404')

const dayData = cells.find((cell) => cell.day === paramDayNumber)

if (!dayData) return Astro.redirect('/404')

const { description, gameType, gameData } = dayData

// Verificar si el usuario está autenticado
const user = Astro.locals.user
const isAuthenticated = !!user

// Verificar si el usuario es administrador
const userIsAdmin = isAdmin(user?.id)

// Verificar si el día ya es accesible (usando hora CET)
const today = new Date()
const cetTime = new Date(today.toLocaleString('en-US', { timeZone: 'Europe/Madrid' }))
const currentMonth = cetTime.getMonth() // 0-11 (11 = diciembre)
const currentDay = cetTime.getDate()

// Solo es accesible si estamos en diciembre y el día actual es igual o mayor al día de la casilla
const isDayAccessible = currentMonth === 11 && currentDay >= paramDayNumber

// Verificar si el usuario ha validado algún cupón
let hasValidatedCoupon = false
if (user) {
  const { count } = await supabaseAdmin
    .from('coupons')
    .select('*', { count: 'exact', head: true })
    .eq('used_by', user.id)
    .eq('is_used', true)

  hasValidatedCoupon = (count ?? 0) > 0
}
---

<Layout description={description}>
  <div class="flex min-h-screen flex-col">
    {
      !isDayAccessible && !userIsAdmin ? (
        // 1. Si no es accesible (y no es admin), muestra el countdown
        <>
          <Header />
          <div class="flex flex-1">
            <main class="max-w-4xl mx-auto flex items-center justify-center px-4 py-20 flex-col gap-4">
              <Countdown day={paramDayNumber} />
              <p
                class="text-xl text-white/80 text-center text-balance mb-10 fade-in-up"
                style="animation-delay: 0.2s;"
                aria-live="off"
              >
                {description}
              </p>
            </main>
          </div>
          <Footer />
        </>
      ) : !isAuthenticated ? (
        // 2. Si es accesible pero no está registrado, muestra mensaje de contenido exclusivo
        <>
          <Header />
          <div class="flex flex-1">
            <main class="max-w-4xl mx-auto flex items-center justify-center px-4 py-20 flex-col gap-4">
              <div class="text-center mb-8">
                <svg
                  width="80"
                  height="80"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="mx-auto mb-6 text-brand fade-in-up"
                >
                  <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
                  <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                </svg>
                <h2
                  class="text-3xl md:text-4xl text-brand font-bold mb-4 uppercase fade-in-up"
                  style="font-family: 'Heavy', sans-serif; text-shadow: var(--text-shadow-title); animation-delay: 0.1s;"
                >
                  Contenido Exclusivo
                </h2>
                <p
                  class="text-xl text-white/80 text-center text-balance mb-6 fade-in-up"
                  style="animation-delay: 0.2s;"
                >
                  Debes iniciar sesión para poder acceder a este contenido.
                </p>
                <p
                  class="text-lg text-white/60 text-center text-balance mb-8 fade-in-up"
                  style="animation-delay: 0.3s;"
                >
                  Regístrate gratis y valida tu código del calendario de BigIbai para participar en
                  el sorteo de este premio.
                </p>
              </div>
              <div
                class="flex flex-col sm:flex-row gap-4 fade-in-up"
                style="animation-delay: 0.4s;"
              >
                <Button
                  href={`/registro?redirect=${encodeURIComponent(Astro.url.pathname)}`}
                  variant="brand"
                  size="lg"
                >
                  Iniciar Sesión / Registrarse
                </Button>
                <Button href="/" variant="secondary" size="lg">
                  Volver al Inicio
                </Button>
              </div>
            </main>
          </div>
          <Footer />
        </>
      ) : !hasValidatedCoupon && !userIsAdmin ? (
        // 2.5. Si está registrado pero NO ha validado cupón, muestra popup
        <>
          <Header />
          <div class="flex flex-1">
            <main class="max-w-6xl mx-auto flex items-center justify-center px-4 py-20">
              <div class="grid md:grid-cols-2 gap-8 md:gap-12 items-center">
                <div class="text-center md:text-left">
                  <h2 class="text-3xl md:text-5xl text-brand font-bold mb-6 uppercase fade-in-up leading-tighter text-balance text-shadow-title">
                    ¡Tienes que validar tu cupón!
                  </h2>
                  <p
                    class="text-xl text-white/80 text-balance mb-8 fade-in-up leading-relaxed text-center text-shadow-title"
                    style="animation-delay: 0.2s;"
                  >
                    Antes de resolver el reto de hoy, tienes que validar al menos un cupón. ¡Busca
                    en tu tu calendario de BigIbai el código que está localizado detrás de la caja
                    de chocolate!
                  </p>

                  <div
                    class="fade-in-up flex justify-center md:justify-center gap-x-2"
                    style="animation-delay: 0.4s;"
                  >
                    <Button href="/dashboard" variant="brand" size="lg">
                      Llévame a validar mi cupón
                    </Button>
                    <Button href={Astro.url.pathname} variant="secondary" size="lg">
                      ¡Ya lo he validado!
                    </Button>
                  </div>
                </div>

                <div class="flex justify-center">
                  <video
                    class="w-full max-w-[300px] rounded-xl shadow-2xl fade-in-up"
                    playsinline
                    muted
                    loop
                    autoplay
                    style="animation-delay: 0.5s;"
                  >
                    <source
                      src="https://videos.bigibai.com/premios/tutorial.webm"
                      type="video/webm"
                    />
                    <source
                      src="https://videos.bigibai.com/premios/tutorial.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>
              </div>
            </main>
          </div>
          <Footer />
        </>
      ) : (
        // 3. Si es accesible y está registrado (y tiene cupón o es admin), muestra el contenido completo
        <div id="casilla-flow" class="flex-1 relative text-xs">
          {/* Aviso de admin si está viendo una casilla que aún no es visible para todos */}
          {userIsAdmin && !isDayAccessible && (
            <div class="admin-notice">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" />
                <path d="m9 12 2 2 4-4" />
              </svg>
              <span class="text-xs text-balance inline-block text-center">
                Vista previa de admin - Esta casilla no es visible para usuarios
              </span>
            </div>
          )}

          <canvas id="confetti-canvas" class="confetti-canvas w-full h-full" />

          {/* Pantalla 1: Animación de apertura con calendario */}
          <div id="screen-opening" class="screen active">
            <div class="opening-animation relative">
              <div class="scene">
                <div class="calendar-wrapper" id="calendarWrapper">
                  <img src="/calendar.webp" alt="Calendario" class="bg-image" />
                  <div class="grid-layer" id="gridLayer" />
                </div>
              </div>
            </div>
          </div>

          {/* Pantalla 2: Adivina el premio */}
          <div id="screen-guess" class="screen">
            <div class="screen-content">
              <div class="text-center mb-8">
                <h1
                  class="text-4xl md:text-5xl text-brand font-bold mb-4 uppercase"
                  style="font-family: 'Heavy', sans-serif; text-shadow: var(--text-shadow-title);"
                >
                  ¡Desvela el premio
                  <br />
                  del día {paramDayNumber}!
                </h1>
                <p class="text-white/70 text-lg">
                  Resuelve el reto para descubrir el sorteo de hoy
                </p>
              </div>

              <div class="chocolate-reveal">
                <img
                  src={`/chocolatinas/${paramDayNumber}.webp`}
                  alt="Chocolatina"
                  class="chocolate-image floating-chocolate"
                  onerror="this.src='/chocolatinas/1.webp'"
                />
              </div>

              <div class="flex flex-col gap-4 mt-12 max-w-[320px] mx-auto">
                <Button id="btn-start-game" variant="brand" size="lg" class="w-full">
                  ¡Empezar el reto!
                </Button>
              </div>
            </div>
          </div>

          {/* Pantalla 3: Renderizar el componente de juego según el tipo */}
          <div id="screen-game" class="screen">
            {gameType === 'anagram' && <AnagramGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'trivia' && <TriviaGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'puzzle' && <PuzzleGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'memory' && <MemoryGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'racer' && <RacerGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'camper' && <CamperGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'snake' && <SnakeGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'circus' && <CircusGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'safari' && <SafariGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'hamster' && <HamsterGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'dron' && <DronGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'flight' && <FlightGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'arkanoid' && <ArkanoidGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'sea' && <SeaGame day={paramDayNumber} gameData={gameData} />}
            {gameType === 'noise' && <NoiseGame day={paramDayNumber} gameData={gameData} />}
          </div>
        </div>
      )
    }
  </div>
</Layout>

<style>
  :root {
    /* Variables de ajuste */
    --pad-top: 3%;
    --pad-bottom: 5%;
    --pad-side: 7%;
    --gap-row: 16px;
    --gap-col: 26px;

    /* Variables de animación */
    --zoom-scale: 3.5;
    --bg-image: url('/calendar.webp');
  }

  /* Contenedor principal */
  #casilla-flow {
    overflow-y: auto;
    overflow-x: hidden;
  }

  /* Oscurecer el fondo más durante el flujo de casillas */
  #casilla-flow::before {
    content: '';
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.75);
    z-index: -1;
    pointer-events: none;
  }

  .confetti-canvas {
    position: absolute;
    inset: 0;
    z-index: 50;
    pointer-events: none;
  }

  /* Pantallas */
  .screen {
    position: absolute;
    inset: 0;
    width: 100%;
    min-height: 100vh;
    min-height: 100dvh;
    display: none;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.5s ease;
    padding: 2rem 0;
  }

  .screen.opening {
    padding: 0;
  }

  .screen.active {
    display: flex;
    position: relative;
    opacity: 1;
    pointer-events: auto;
  }

  .screen-content {
    max-width: 600px;
    width: 100%;
    margin: 0 auto;
  }

  /* Pantalla 1: Animación de apertura */
  .opening-animation {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: visible;
  }

  .scene {
    position: relative;
    width: 100%;
    max-width: 500px;
    height: auto;
    perspective: 1000px;
    z-index: 2;
  }

  .calendar-wrapper {
    position: relative;
    width: 100%;
    transform-style: preserve-3d;
    transition: transform 1s cubic-bezier(0.25, 1, 0.5, 1);
    cursor: default;
  }

  .calendar-wrapper.shake {
    animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) infinite;
  }

  .calendar-wrapper.is-zoomed {
    cursor: pointer;
  }

  .bg-image {
    width: 100%;
    display: block;
    border-radius: 10px;
    pointer-events: none;
  }

  .grid-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(6, 1fr);
    padding-top: var(--pad-top);
    padding-bottom: var(--pad-bottom);
    padding-left: var(--pad-side);
    padding-right: var(--pad-side);
    column-gap: var(--gap-col);
    row-gap: var(--gap-row);
    pointer-events: none;
  }

  /* Estilos para las puertas generadas dinámicamente */
  :global(.door-container) {
    position: relative;
    width: 100%;
    height: 100%;
    pointer-events: auto;
    cursor: pointer;
    perspective: 600px;
    transform-style: preserve-3d;
  }

  :global(.door-flipper) {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transform-origin: left center;
    transition: transform 0.6s cubic-bezier(0.4, 2, 0.6, 1);
  }

  :global(.door-container.is-open .door-flipper) {
    transform: rotateY(-110deg);
  }

  :global(.door-front) {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 2px;
    background-image: var(--bg-image);
    background-size: 400% 600%;
    color: transparent;
    text-shadow: none;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    font-size: 1.2rem;
    z-index: 2;
    transition:
      color 0.3s ease,
      text-shadow 0.3s ease;
  }

  :global(.door-container:hover .door-front),
  :global(.door-container.is-open .door-front) {
    color: rgba(255, 255, 255, 0.8);
    text-shadow: 0 2px 4px black;
  }

  :global(.door-back) {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 4px;
    background-color: #eaeaea;
    background-image: linear-gradient(to bottom right, #e6e6e6, #f2f2f2);
    border: 1px solid rgba(0, 0, 0, 0.05);
    transform: rotateY(180deg);
    display: flex;
    justify-content: center;
    align-items: center;
  }

  :global(.door-hole) {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #1a1a1a;
    border-radius: 4px;
    z-index: 0;
    box-shadow: inset 0 0 10px black;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  :global(.door-chocolate) {
    width: 80%;
    height: auto;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
    transform: rotate(-5deg);
  }

  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: scale(0.8);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  /* Chocolate Reveal */
  .chocolate-reveal {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 2rem 0;
    animation: fadeInScale 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  }

  .chocolate-image {
    width: 120px;
    height: auto;
    filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.5));
    transform: rotate(-5deg);
    transition: transform 0.3s ease;
  }

  @media (min-width: 768px) {
    .chocolate-image {
      width: 250px;
    }
  }

  .chocolate-image:hover {
    transform: rotate(0deg) scale(1.05);
  }

  @keyframes float {
    0%,
    100% {
      transform: rotate(-10deg) translateY(0px);
    }
    50% {
      transform: rotate(-5deg) translateY(-20px);
    }
  }

  .floating-chocolate {
    animation: float 6s ease-in-out infinite;
  }

  @keyframes shake {
    0% {
      transform: translate(0, 0) rotate(0deg);
    }
    10% {
      transform: translate(-5px, -5px) rotate(-3deg);
    }
    20% {
      transform: translate(5px, 5px) rotate(3deg);
    }
    30% {
      transform: translate(-5px, 5px) rotate(-3deg);
    }
    40% {
      transform: translate(5px, -5px) rotate(3deg);
    }
    50% {
      transform: translate(-5px, -5px) rotate(-3deg);
    }
    60% {
      transform: translate(5px, 5px) rotate(3deg);
    }
    70% {
      transform: translate(-5px, 5px) rotate(-3deg);
    }
    80% {
      transform: translate(5px, -5px) rotate(3deg);
    }
    90% {
      transform: translate(-5px, -5px) rotate(-3deg);
    }
    100% {
      transform: translate(0, 0) rotate(0deg);
    }
  }

  /* Aviso de administrador */
  .admin-notice {
    position: fixed;
    top: 1rem;
    left: 1rem;
    z-index: 100;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: rgba(248, 177, 52, 0.95);
    backdrop-filter: blur(10px);
    border: 2px solid rgba(248, 177, 52, 1);
    border-radius: 0.5rem;
    color: #000;
    font-size: 0.875rem;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(248, 177, 52, 0.3);
    animation: slideInLeft 0.5s ease-out;
  }

  .admin-notice svg {
    flex-shrink: 0;
  }

  @keyframes slideInLeft {
    from {
      transform: translateX(-100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @media (max-width: 768px) {
    .admin-notice {
      left: 0.5rem;
      right: 0.5rem;
      font-size: 0.75rem;
      padding: 0.5rem 0.75rem;
    }

    .admin-notice span {
      line-height: 1.3;
    }
  }
</style>

<script>
  import confetti from 'canvas-confetti'

  document.addEventListener('astro:page-load', () => {
    const $ = document.querySelector.bind(document)

    // Obtener el día desde la URL
    const pathParts = window.location.pathname.split('/')
    const dayMatch = pathParts.find((part) => part.startsWith('casilla-'))
    const day = dayMatch ? parseInt(dayMatch.split('-')[1]) : 1

    // Configuración del calendario
    const doorNumbers = [
      14, 7, 10, 22, 3, 15, 13, 12, 21, 16, 20, 2, 9, 5, 24, 8, 19, 11, 18, 1, 4, 17, 6, 23,
    ]

    // Elementos del DOM
    const screens = {
      opening: $('#screen-opening') as HTMLDivElement,
      guess: $('#screen-guess') as HTMLDivElement,
      game: $('#screen-game') as HTMLDivElement,
    }

    const gridLayer = $('#gridLayer') as HTMLDivElement
    const wrapper = $('#calendarWrapper') as HTMLDivElement
    let isZoomed = false
    let activeDoor: HTMLElement | null = null
    let currentScreen: keyof typeof screens = 'opening'

    // Inicialización del calendario
    function initCalendar() {
      if (!gridLayer || !wrapper) {
        return
      }

      doorNumbers.forEach((number, index) => {
        const cell = document.createElement('div')
        cell.className = 'door-container'
        cell.id = `door-${index}`

        const holeContent =
          number === day
            ? `<img src="/chocolatinas/${day}.webp" class="door-chocolate" alt="Chocolate" />`
            : ''

        cell.innerHTML = `
            <div class="door-hole">${holeContent}</div>
            <div class="door-flipper">
              <div class="door-front">
                <span>${number}</span>
              </div>
              <div class="door-back"></div>
            </div>
          `

        cell.addEventListener('click', (e) => {
          e.stopPropagation()
          handleDoorClick(cell, index)
        })

        gridLayer.appendChild(cell)
      })

      requestAnimationFrame(updateDoorBackgrounds)

      const resizeObserver = new ResizeObserver(() => {
        updateDoorBackgrounds()
      })
      resizeObserver.observe(wrapper)
    }

    function updateDoorBackgrounds() {
      if (!wrapper) return
      const wrapperRect = wrapper.getBoundingClientRect()
      const doors = document.querySelectorAll('.door-front') as NodeListOf<HTMLElement>

      doors.forEach((door) => {
        const doorRect = door.getBoundingClientRect()
        const offsetX = doorRect.left - wrapperRect.left
        const offsetY = doorRect.top - wrapperRect.top

        door.style.backgroundSize = `${wrapperRect.width}px ${wrapperRect.height}px`
        door.style.backgroundPosition = `-${offsetX}px -${offsetY}px`
      })
    }

    // Lógica de ZOOM + CENTRADO
    function handleDoorClick(doorElement: HTMLElement, index: number) {
      if (isZoomed || !wrapper) return

      isZoomed = true
      activeDoor = doorElement

      const rect = doorElement.getBoundingClientRect()
      const wrapperRect = wrapper.getBoundingClientRect()

      const doorCenterX = rect.left + rect.width / 2
      const doorCenterY = rect.top + rect.height / 2

      const targetCenterX = wrapperRect.left + wrapperRect.width / 2
      const targetCenterY = wrapperRect.top + wrapperRect.height / 2

      const originX = doorCenterX - wrapperRect.left
      const originY = doorCenterY - wrapperRect.top

      wrapper.style.transformOrigin = `${originX}px ${originY}px`

      const moveX = targetCenterX - doorCenterX
      const moveY = targetCenterY - doorCenterY

      wrapper.style.transform = `translate(${moveX}px, ${moveY}px) scale(var(--zoom-scale))`
      wrapper.classList.add('is-zoomed')

      setTimeout(() => {
        doorElement.classList.add('is-open')

        setTimeout(() => {
          transitionToScreen('guess')
        }, 1000)
      }, 800)
    }

    // Animación inicial automática
    function startOpeningAnimation() {
      if (!wrapper) {
        return
      }

      const SHAKE_DURATION = 1500

      setTimeout(() => {
        wrapper.classList.add('shake')
        launchChristmasConfetti(SHAKE_DURATION)

        setTimeout(() => {
          wrapper.classList.remove('shake')

          const dayIndex = doorNumbers.indexOf(day)
          if (dayIndex !== -1) {
            const doorElement = document.getElementById(`door-${dayIndex}`)
            if (doorElement) {
              handleDoorClick(doorElement, dayIndex)
            }
          }
        }, SHAKE_DURATION)
      }, 500)
    }

    // Configurar canvas de confetti
    const canvas = document.getElementById('confetti-canvas') as HTMLCanvasElement
    const myConfetti = canvas
      ? confetti.create(canvas, {
          resize: true,
          useWorker: true,
        })
      : null

    // Función para lanzar confetti navideño
    function launchChristmasConfetti(duration = 3000) {
      if (!myConfetti) return

      const animationEnd = Date.now() + duration
      const defaults = {
        startVelocity: 30,
        spread: 360,
        ticks: 60,
        zIndex: 1,
      }

      const interval = setInterval(function () {
        const timeLeft = animationEnd - Date.now()

        if (timeLeft <= 0) {
          return clearInterval(interval)
        }

        const particleCount = 100 * (timeLeft / duration)

        myConfetti({
          ...defaults,
          particleCount,
          origin: { x: 0.5, y: 0.5 },
          colors: ['#ff0000', '#00ff00', '#ffffff', '#FFD700'],
          scalar: 1.2,
        })
      }, 250)
    }

    function transitionToScreen(screenName: keyof typeof screens) {
      if (screens[currentScreen]) {
        screens[currentScreen]?.classList.remove('active')
      }

      if (screens[screenName]) {
        screens[screenName]?.classList.add('active')
        currentScreen = screenName

        if (screenName === 'game') {
          // Disparar evento para que el juego se inicie
          setTimeout(() => {
            window.dispatchEvent(new CustomEvent('start-game'))
          }, 100)
        }
      }
    }

    // Inicializar el calendario
    function init() {
      initCalendar()
      startOpeningAnimation()

      document.getElementById('btn-start-game')?.addEventListener('click', () => {
        transitionToScreen('game')
      })
    }

    init()
  })
</script>
