---
import { ACHIEVEMENTS } from '@/data/achievements'
import BentoCard from '@/components/ui/BentoCard.astro'
import Button from '@/components/Button.astro'

interface Props {
  isLoggedIn: boolean
  userAchievements: Record<string, { created_at: string }>
}

const { isLoggedIn, userAchievements } = Astro.props

const allAchievements = Object.values(ACHIEVEMENTS)
---

<BentoCard class="group col-span-3 md:col-span-1 py-8 px-4" style="animation-delay: 0.3s;">
  <div class="flex flex-col gap-6">
    <div class="flex items-center justify-between flex-col">
      <h2 class="text-shadow-title text-3xl font-heavy font-bold text-white md:text-5xl">
        Mis Logros
      </h2>
    </div>

    <div class="relative flex flex-col items-center justify-center">
      {
        !isLoggedIn && (
          <div class="absolute z-10 flex flex-col items-center gap-4 h-full w-full justify-center px-4">
            <p class="text-lg text-white/80 text-balance text-center leading-tight">
              Inicia sesión para desbloquear y guardar tus logros
            </p>
            <Button href="/registro" variant="brand" size="lg">
              Iniciar sesión
            </Button>
          </div>
        )
      }

      <div class={`grid grid-cols-3 gap-2 ${!isLoggedIn ? 'blur-xs' : ''}`}>
        {
          allAchievements.map((achievement) => {
            const isUnlocked = !!userAchievements[achievement.id]
            return (
              <div
                class:list={[
                  'flex flex-col items-center gap-3 p-2 transition-all duration-300',
                  isUnlocked
                    ? 'scale-100'
                    : 'opacity-60 grayscale hover:opacity-80 hover:grayscale-0',
                ]}
                data-tip={isUnlocked ? achievement.descriptionDone : achievement.descriptionDo}
              >
                <div class="relative group/icon">
                  <img
                    src={achievement.image}
                    alt={achievement.title}
                    class="w-16 h-16 object-contain drop-shadow-lg"
                    loading="lazy"
                  />
                </div>
                <div class="text-center relative">
                  <p class="text-[10px] lg:text-xs font-bold text-white leading-tight mb-1">
                    {achievement.title}
                  </p>
                </div>
              </div>
            )
          })
        }
      </div>
    </div>
  </div>
</BentoCard>
