---
import "@/global.css"

import GradientOverlay from "@/components/GradientOverlay.astro"
import AnimatedBackground from "@/components/AnimatedBackground.astro"
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>bigibai - ¡Algo grande se acerca!</title>
    <meta name="description" content="bigibai - ¡Algo grande se acerca!" />
    <meta name="keywords" content="bigibai" />
    <meta name="author" content="Ibai Llanos" />

    <link
      rel="preload"
      href="/fonts/century.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/century-bold.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/heavy.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />

  </head>
  <body>
    <AnimatedBackground />
    <div id="background-mask" class="min-h-screen w-full">
      <GradientOverlay />
      <div class="floating-particles"></div>
      <div class="relative z-2">
        <slot />
      </div>
    </div>
  </body>
</html>

<style>
  body {
    background: #000;
    overflow-x: hidden;
  }

  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }

  /* Prevent scrolling during initial animations */
  body.loading {
    overflow: hidden;
  }

  #background-mask {
    background-image: url("/fondo.webp");
    background-size: cover;
    background-position: top;
    background-repeat: no-repeat;

    mask-image: url("/lock.svg");
    mask-position: center 50%;
    mask-repeat: no-repeat;
    mask-size: 50px;

    &.unlocked {
      animation: lock-reveal 3s forwards ease-in-out;
    }
  }

  @keyframes lock-reveal {
    0% {
      mask-size: 50px;
    }

    100% {
      mask-size: 1000vh;
    }
  }

  .floating-particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    opacity: 0.3;
  }

  .floating-particles::before,
  .floating-particles::after {
    content: '';
    position: absolute;
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(248, 177, 52, 0.15) 0%, transparent 70%);
    filter: blur(40px);
    animation: float-particle 20s ease-in-out infinite;
  }

  .floating-particles::before {
    top: 20%;
    left: 10%;
    animation-delay: 0s;
  }

  .floating-particles::after {
    bottom: 20%;
    right: 10%;
    animation-delay: -10s;
  }

  @keyframes float-particle {
    0%, 100% {
      transform: translate(0, 0) scale(1);
    }
    25% {
      transform: translate(30px, -30px) scale(1.1);
    }
    50% {
      transform: translate(-20px, 40px) scale(0.9);
    }
    75% {
      transform: translate(40px, 20px) scale(1.05);
    }
  }

  /* Smooth parallax scrolling */
  @media (prefers-reduced-motion: no-preference) {
    #background-mask {
      transition: transform 0.1s ease-out;
    }
  }
</style>

<script>
  const backgroundMask = document.getElementById(
    "background-mask"
  ) as HTMLDivElement;

  // Subtle parallax effect when moving the mouse
  let mouseX = 0,
      mouseY = 0,
      currentX = 0,
      currentY = 0;

  // Prevent scrolling during initial animations
  document.body.classList.add('loading');

  document.addEventListener("DOMContentLoaded", () => {
    backgroundMask.classList.add("unlocked");
    
    // Remove the loading class after the initial animations finish.
    setTimeout(() => {
      document.body.classList.remove('loading');
    }, 1500)
  })

  document.addEventListener("mousemove", (e) => {
    mouseX = (e.clientX / window.innerWidth - 0.5) * 20;
    mouseY = (e.clientY / window.innerHeight - 0.5) * 20;
  })

  function animate() {
    const ease = 0.05;

    currentX += (mouseX - currentX) * ease;
    currentY += (mouseY - currentY) * ease;

    if (backgroundMask) {
      const particles = document.querySelector('.floating-particles') as HTMLElement;
      if (particles) {
        particles.style.transform = `translate(${currentX}px, ${currentY}px)`;
      }
    }

    requestAnimationFrame(animate)
  }

  if (window.matchMedia('(prefers-reduced-motion: no-preference)').matches) {
    animate()
  }
</script>

<script>
  import { initScrollAnimations, initParallaxEffect, init3DHoverEffect } from '@/utils/animations'
  
  // Initialize animations
  document.addEventListener('DOMContentLoaded', () => {
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches
    
    if (!prefersReducedMotion) {
      initScrollAnimations()
      initParallaxEffect()
      init3DHoverEffect()
    }
  })
</script>
