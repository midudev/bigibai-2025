---
import Button from '@/components/Button.astro'
import AchievementsBox from '@/components/AchievementsBox.astro'
import BentoCard from '@/components/ui/BentoCard.astro'
import Chocolates from './Chocolates.astro'
import Calendar from './Calendar.astro'
import Map from '@/components/Map.astro'

interface Props {
  isLoggedIn: boolean
  participationCount: number
  userAchievements: Record<string, { created_at: string }>
}

const { isLoggedIn, participationCount, userAchievements } = Astro.props
---

<main
  id="main-content"
  class="mx-auto w-full max-w-7xl px-4 py-12 md:py-20"
  tabindex="-1"
>
  <!-- Bento Grid -->
  <div class="grid grid-cols-1 gap-4 md:grid-cols-3 md:gap-6">
    <!-- Columna 1 y 2: Validar código (span 2 columnas) -->

    <BentoCard class="group col-span-3 overflow-hidden md:col-span-2 flex flex-col md:flex-row p-4">
      <img
        src="/hero.webp"
        alt="Imagen que explica que en la casilla de atrás hay código para canjear y participar"
        class="h-auto w-[300px] md:w-[150px] lg:w-[250px] object-contain mx-auto group-hover:scale-110 transition-transform duration-300 group-hover:rotate-6"
        loading="eager"
      />
      <div class="relative z-10 flex flex-1 flex-col items-start justify-center gap-2">
        <div
          class="relative flex h-full flex-col justify-center gap-6 p-8 md:flex-col md:items-center md:py-0"
        >
          {
            !isLoggedIn ? (
              <>
                <div class="space-y-4 flex justify-center items-center flex-col">
                  <h2 class="text-shadow-title text-3xl font-bold text-white md:text-4xl lg:text-5xl text-balance">
                    Inicia sesión para empezar
                  </h2>
                  <p class="text-lg text-white/80 md:text-xl lg:text-2xl text-center text-pretty">
                    Entra y valida tu código del calendario de adviento para participar en los
                    sorteos
                  </p>
                </div>

                <Button href="/registro" variant="brand" size="lg" class="mt-4 mx-auto">
                  ¡Inicia sesión ahora!
                </Button>
              </>
            ) : (
              <>
                <div class="space-y-2 flex justify-center items-center flex-col">
                  <h2 class="text-shadow-title text-3xl font-bold text-white md:text-4xl lg:text-6xl text-balance leading-none!">
                    {participationCount === 0
                      ? '¡Aún no tienes participaciones!'
                      : participationCount === 1
                        ? '¡Tienes 1 participación!'
                        : `¡Tienes ${participationCount} participaciones!`}
                  </h2>
                  <p class="text-lg text-white/80 md:text-xl lg:text-2xl text-center text-pretty">
                    {participationCount === 0
                      ? 'Valida tu primer código del calendario para empezar a participar en los sorteos'
                      : 'Sigue validando códigos del calendario para aumentar tus oportunidades de ganar'}
                  </p>
                </div>

                <Button href="/dashboard" variant="brand" size="xl" class="mx-auto">
                  {participationCount === 0 ? '¡Validar mi primer código!' : 'Validar más códigos'}
                </Button>
              </>
            )
          }
        </div>
      </div>
    </BentoCard>

    <BentoCard class="group col-span-3 md:col-span-1">
      <div class="relative flex h-full min-h-[400px] flex-col justify-between p-8 md:p-10">
        <!-- Imagen del producto -->
        <div class="mb-6 flex flex-1 items-center justify-center">
          <img
            src="/calendario-producto.webp"
            alt="Calendario Big Ibai 2025"
            class="h-auto w-52 object-contain transition-transform duration-300 group-hover:scale-110 mt-0 md:-mt-40"
            loading="eager"
          />
        </div>

        <!-- Contenido -->
        <div class="space-y-4">
          <h3
            class="text-shadow-title text-2xl font-bold text-white md:text-3xl text-balance text-center"
          >
            Calendario Big Ibai 2025
          </h3>

          <p class="text-base md:hidden text-white/80 md:text-lg text-balance text-center">
            Consigue tu calendario en los mejores supermercados
          </p>

          <Button variant="secondary" size="lg" class="w-full" href='#tiendas'>
            <p class="flex items-center justify-center gap-2">
              ¿Dónde lo compro?
            </p>
          </Button>
        </div>
      </div>
    </BentoCard>

    <AchievementsBox isLoggedIn={isLoggedIn} userAchievements={userAchievements} />

    <Chocolates />

    <Calendar />

    <Map />
  </div>
</main>
